---
title: "Manhattan Rat Sighting Data"
output: 
  html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
library(tidyverse)
library(leaflet)
library(lubridate)
library(shiny)
library(plotly)
library(htmltools)

knitr::opts_chunk$set(
    echo = TRUE,
    warning = FALSE,
    fig.width = 30, 
  fig.height = 35
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

rat_sightings_data <- read.csv("./datasets_clean/rat_sightings_data")
population_data <- read.csv("./datasets_clean/population_data")

```

![](https://www.cbc.ca/natureofthings/content/images/CBC_Rat_City_FA_Horizontal_1920.jpg)


### Bar Plot: Average Annual Rat Sightings across Boroughs 
<details>
  <summary>Code</summary>
```{r, eval=FALSE}
# Filter data for the years 2015-2019
barplot_rat_data <- rat_sightings_data %>%
  filter(year_created >= 2015 & year_created <= 2019)

# Calculate the average annual rat sightings by borough
average_sightings_by_borough <- barplot_rat_data %>%
  group_by(year_created, borough) %>%
  summarise(average_sightings = n() / length(unique(month_created)))

# Create a bar plot
ggplot(average_sightings_by_borough, aes(x = borough, y = average_sightings, fill = factor(year_created))) +
  geom_bar(stat = "identity", position = "dodge", color = "black") +
  labs(title = "Average Annual Rat Sightings by Borough (2015-2019)",
      x = "Borough",
      y = "Average Annual Rat Sightings") +
  scale_fill_manual(name = "Year", values = c("2015" = "skyblue", "2016" = "orange", "2017" = "pink", "2018" = "purple", "2019" = "red")) +
  theme_minimal()
```
</details>

```{r, echo=FALSE, fig.width=10, fig.height=8}
# Create a bar plot
ggplot(average_sightings_by_borough, aes(x = borough, y = average_sightings, fill = factor(year_created))) +
  geom_bar(stat = "identity", position = "dodge", color = "black") +
  labs(title = "Average Annual Rat Sightings by Borough (2015-2019)",
      x = "Borough",
      y = "Average Annual Rat Sightings") +
  scale_fill_manual(name = "Year", values = c("2015" = "skyblue", "2016" = "orange", "2017" = "pink", "2018" = "purple", "2019" = "red")) +
  theme_minimal()
```



### Monthly Trends in NYC Rat Sightings (2015-2020) 
<details>
  <summary>Code</summary>
```{r, eval=FALSE}
# Filter data for the years 2015-2019
filtered_rat_data <- rat_sightings_data %>%
  filter(year_created >= 2015 & year_created <= 2019)

# Line plot for the number of rat sightings by month with points
ggplot(filtered_rat_data, aes(x = month_created, group = year_created)) +
  geom_line(aes(y = after_stat(count), color = factor(year_created)), stat = "count") +
  geom_point(aes(y = after_stat(count), color = factor(year_created)), stat = "count", size = 2) +
  labs(title = "Number of Rat Sightings by Month (2015-2020)",
      x = "Month",
      y = "Number of Rat Sightings") +
  scale_x_discrete(labels = c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")) +
  scale_color_discrete(name = "Year") +
  theme_minimal()

```
</details>

```{r, echo=FALSE, fig.width=10, fig.height=8}
# Line plot for the number of rat sightings by month with points
ggplot(filtered_rat_data, aes(x = month_created, group = year_created)) +
  geom_line(aes(y = after_stat(count), color = factor(year_created)), stat = "count") +
  geom_point(aes(y = after_stat(count), color = factor(year_created)), stat = "count", size = 2) +
  labs(title = "Number of Rat Sightings by Month (2015-2020)",
      x = "Month",
      y = "Number of Rat Sightings") +
  scale_x_discrete(labels = c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")) +
  scale_color_discrete(name = "Year") +
  theme_minimal() 
```


### Residential Rat Sightings by Borough
```{r, echo=FALSE, fig.width=10, fig.height=8}
# Specify the desired location types
desired_location_types <- c(
  "3+ Family Apt. Building", 
  "1-2 Family Dwelling", 
  "3+ Family Mixed Use Building", 
  "1-2 Family Mixed Use Building", 
  "3+ Family Apartment Building", 
  "Single Room Occupancy (SRO)", 
  "Apartment", 
  "Residence", 
  "1-3 Family Dwelling",
  "Residential Property",
  "1-3 Family Mixed Use Building",
  "3+ Family Apt., Private House"
)

# Create a new dataset with only residential sightings
residential_sightings <- rat_sightings_data %>%
  filter(location_type %in% desired_location_types)
  
# Step 1: Calculate the count of residential rat sightings by borough
residential_counts <- residential_sightings %>%
  group_by(borough) %>%
  summarise(residential_count = n())

# Step 2: Calculate the total count of rat sightings by borough
total_counts <- rat_sightings_data %>%
  group_by(borough) %>%
  summarise(total_count = n())

# Step 3: Merge the two datasets and calculate the proportion
borough_proportions <- merge(residential_counts, total_counts, by = "borough", all.x = TRUE) %>%
  mutate(proportion_residential = residential_count / total_count)

# Print the result
knitr::kable(borough_proportions)

# Create an interactive bar plot
plot_ly(
  data = borough_proportions,
  x = ~borough,
  y = ~proportion_residential,
  type = "bar",
  marker = list(color = "skyblue")
) %>%
  layout(
    title = "Proportion of Residential Rat Sightings by Borough",
    xaxis = list(title = "Borough"),
    yaxis = list(title = "Proportion"),
    showlegend = FALSE
  )

```


