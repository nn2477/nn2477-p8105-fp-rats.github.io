---
title: "Manhattan Rat Sighting Data"
output: 
  html_document:
    toc: true
    toc_float: true
---

![Spotted: NYC Subway Rat in the Wild](images/rat.jpeg)

```{r setup, include=FALSE}
library(tidyverse)
library(leaflet)
library(lubridate)
library(shiny)
library(htmltools)

knitr::opts_chunk$set(
    echo = TRUE,
    warning = FALSE,
    fig.width = 30, 
  fig.height = 35
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

rat_sightings_data <- read.csv("./datasets_clean/rat_sightings_data")
population_data <- read.csv("./datasets_clean/population_data")

```

![](https://www.cbc.ca/natureofthings/content/images/CBC_Rat_City_FA_Horizontal_1920.jpg)


### Bar Plots: Average Annual Rat Sightings across Boroughs 
<details>
  <summary>Code</summary>
```{r}
# Filter data for the years 2015-2019
barplot_rat_data <- rat_sightings_data %>%
  filter(year_created >= 2015 & year_created <= 2019)

# Calculate the average annual rat sightings by borough
average_sightings_by_borough <- barplot_rat_data %>%
  group_by(year_created, borough) %>%
  summarise(average_sightings = n() / length(unique(month_created)))

# Create a bar plot
ggplot(average_sightings_by_borough, aes(x = borough, y = average_sightings, fill = factor(year_created))) +
  geom_bar(stat = "identity", position = "dodge", color = "black") +
  labs(title = "Average Annual Rat Sightings by Borough (2015-2019)",
      x = "Borough",
      y = "Average Annual Rat Sightings") +
  scale_fill_manual(name = "Year", values = c("2015" = "skyblue", "2016" = "orange", "2017" = "pink", "2018" = "purple", "2019" = "red")) +
  theme_minimal()
```
</details>

```{r, echo=FALSE, fig.width=10, fig.height=8}
# Create a bar plot
ggplot(average_sightings_by_borough, aes(x = borough, y = average_sightings, fill = factor(year_created))) +
  geom_bar(stat = "identity", position = "dodge", color = "black") +
  labs(title = "Average Annual Rat Sightings by Borough (2015-2019)",
      x = "Borough",
      y = "Average Annual Rat Sightings") +
  scale_fill_manual(name = "Year", values = c("2015" = "skyblue", "2016" = "orange", "2017" = "pink", "2018" = "purple", "2019" = "red")) +
  theme_minimal()
```



### Monthly Trends in NYC Rat Sightings (2015-2020) 
<details>
  <summary>Code</summary>
```{r}
# Filter data for the years 2015-2019
filtered_rat_data <- rat_sightings_data %>%
  filter(year_created >= 2015 & year_created <= 2019)

# Line plot for the number of rat sightings by month with points
ggplot(filtered_rat_data, aes(x = month_created, group = year_created)) +
  geom_line(aes(y = after_stat(count), color = factor(year_created)), stat = "count") +
  geom_point(aes(y = after_stat(count), color = factor(year_created)), stat = "count", size = 2) +
  labs(title = "Number of Rat Sightings by Month (2015-2020)",
      x = "Month",
      y = "Number of Rat Sightings") +
  scale_x_discrete(labels = c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")) +
  scale_color_discrete(name = "Year") +
  theme_minimal()

```
</details>


```{r, echo=FALSE, fig.width=10, fig.height=8}
# Line plot for the number of rat sightings by month with points
ggplot(filtered_rat_data, aes(x = month_created, group = year_created)) +
  geom_line(aes(y = after_stat(count), color = factor(year_created)), stat = "count") +
  geom_point(aes(y = after_stat(count), color = factor(year_created)), stat = "count", size = 2) +
  labs(title = "Number of Rat Sightings by Month (2015-2020)",
      x = "Month",
      y = "Number of Rat Sightings") +
  scale_x_discrete(labels = c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")) +
  scale_color_discrete(name = "Year") +
  theme_minimal() 
```

## Average Rat Sightings Per Person by Borough 2020

```{r, echo=FALSE, fig.width=10, fig.height=8}
avg_rat_sightings_borough = 
  rat_sightings_data %>% 
  filter(year_created == 2020) %>% 
  mutate(unique_key = as_factor(unique_key)) %>% 
  group_by(borough) %>% 
  summarize(count = n_distinct(unique_key))

rat_to_population = 
  left_join(avg_rat_sightings_borough, population_data, by = "borough") %>% 
  mutate(rat_population = count / population)

rat_to_population %>% 
  ggplot(aes(x = borough, y = rat_population, fill = borough))+
  geom_bar(stat = "identity")+
  labs(title = "Rat Per Person Ratio by Borough in 2020",
      x = "Borough",
      y = "Rat Per Person Ratio") +
  scale_fill_manual(name = "Borough", values = c("Manhattan" = "skyblue", "Bronx" = "orange", "Brooklyn" = "pink", "Queens" = "purple", "Staten Island" = "red")) +
  theme_minimal()
  
```

