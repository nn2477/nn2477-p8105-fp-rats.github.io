---
title: "Manhattan Rat Sighting Data"
output: 
  html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
library(tidyverse)
library(leaflet)
library(lubridate)

knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 30, 
  fig.height = 35
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

rat_sightings_data <- read.csv("./datasets_clean/rat_sightings_data")

```

![](https://www.cbc.ca/natureofthings/content/images/CBC_Rat_City_FA_Horizontal_1920.jpg)

### Filtering Dataset 
```{r, message=FALSE}
# Filter data for the years 2015-2019 and for Manhattan only
filtered_rat_data_manhattan <- rat_sightings_data %>%
  filter(
    year_created >= 2015 & year_created <= 2019,
    !is.na(latitude) & !is.na(longitude),
    borough == "Manhattan"
  ) %>%
  select(
    month_created, year_created, latitude, longitude, 
    incident_zip, borough, location_type
  )
variable.names(rat_sightings_data)
```

### Creating maps for each year 
```{r, message=FALSE}
# Create separate maps for each year in Manhattan
maps_manhattan <- list()

for (year in 2015:2019) {
  data_year <- filtered_rat_data_manhattan %>% filter(year_created == year)
  
  maps_manhattan[[as.character(year)]] <- leaflet(data_year) %>%
    addTiles() %>%
    addCircleMarkers(
      lng = ~longitude,
      lat = ~latitude,
      radius = 5,  # Adjust the radius of markers as needed
      popup = ~paste("Location Type", location_type, "<br>Date: ", paste(month_created, year_created, sep = "-"))
    ) %>%
    addLegend("bottomright", colors = "red", labels = paste("Rat Sightings - ", year)) %>%
    addMarkers(
      clusterOptions = markerClusterOptions()
    )
}
```

### Mapping of Rat Sightings in Manhattan by Year 

```{r, echo=FALSE, results='hide'}
# Display each map separately for Manhattan
names(maps_manhattan) <- paste("Rat Sightings -", 2015:2019)
maps_manhattan 

lapply(names(maps_manhattan), function(year) {
  maps_manhattan[[year]] %>%
    leaflet(width = "10%") %>%
    addTiles() %>%
    setView(lng = -73.97, lat = 40.78, zoom = 13)
})
```

#### 2015
```{r, echo=FALSE}
maps_manhattan[["Rat Sightings - 2015"]] 
```

#### 2016
```{r, echo=FALSE}
maps_manhattan[["Rat Sightings - 2016"]]
```

#### 2017
```{r, echo=FALSE}
maps_manhattan[["Rat Sightings - 2017"]]
```

#### 2018
```{r, echo=FALSE}
maps_manhattan[["Rat Sightings - 2018"]] 
```

#### 2019
```{r, echo=FALSE}
maps_manhattan[["Rat Sightings - 2019"]] 

```



### Bar Plots comparing Average Annual Rat Sightings across Boroughs 

```{r}
# Filter data for the years 2015-2019
barplot_rat_data <- rat_sightings_data %>%
  filter(year_created >= 2015 & year_created <= 2019)

# Calculate the average annual rat sightings by borough
average_sightings_by_borough <- barplot_rat_data %>%
  group_by(year_created, borough) %>%
  summarise(average_sightings = n() / length(unique(month_created)))

# Create a bar plot
ggplot(average_sightings_by_borough, aes(x = borough, y = average_sightings, fill = factor(year_created))) +
  geom_bar(stat = "identity", position = "dodge", color = "black") +
  labs(title = "Average Annual Rat Sightings by Borough (2015-2019)",
       x = "Borough",
       y = "Average Annual Rat Sightings") +
  scale_fill_manual(name = "Year", values = c("2015" = "skyblue", "2016" = "orange", "2017" = "pink", "2018" = "purple", "2019" = "red")) +
  theme_minimal()
```


